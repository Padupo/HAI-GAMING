-- Services
local Lighting = game:GetService("Lighting")
local StarterGui = game:GetService("StarterGui")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

-- Original Lighting Values (to restore later)
local originalFogEnd = Lighting.FogEnd
local originalFogStart = Lighting.FogStart
local originalFogColor = Lighting.FogColor
local originalAmbient = Lighting.Ambient
local originalColorShift_Bottom = Lighting.ColorShift_Bottom
local originalColorShift_Top = Lighting.ColorShift_Top

-- State Variables for Features
local isFogRemoved = false
local isFullbrightActive = false

-- UI Elements
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ModernEffectsUI"
screenGui.ResetOnSpawn = false
screenGui.DisplayOrder = 999

-- Main Window
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainWindow"
mainFrame.Size = UDim2.new(0, 300, 0, 230) -- Điều chỉnh kích thước cho các nút mới
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -115)
mainFrame.BackgroundColor3 = Color3.fromRGB(35, 38, 46)
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

local mainFrameCorner = Instance.new("UICorner")
mainFrameCorner.CornerRadius = UDim.new(0, 8)
mainFrameCorner.Parent = mainFrame

local mainFrameStroke = Instance.new("UIStroke")
mainFrameStroke.Color = Color3.fromRGB(25, 28, 36)
mainFrameStroke.Thickness = 2
mainFrameStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
mainFrameStroke.Parent = mainFrame

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 35)
titleBar.BackgroundColor3 = Color3.fromRGB(45, 48, 56)
titleBar.BorderSizePixel = 0
titleBar.Parent = mainFrame

local titleLabel = Instance.new("TextLabel")
titleLabel.Name = "TitleLabel"
titleLabel.Size = UDim2.new(1, -10, 1, 0)
titleLabel.Position = UDim2.new(0, 10, 0, 0)
titleLabel.BackgroundTransparency = 1
titleLabel.TextColor3 = Color3.fromRGB(220, 225, 230)
titleLabel.Text = "Effects Control"
titleLabel.Font = Enum.Font.GothamSemibold
titleLabel.TextSize = 18
titleLabel.TextXAlignment = Enum.TextXAlignment.Left
titleLabel.Parent = titleBar

local accentLine = Instance.new("Frame")
accentLine.Name = "AccentLine"
accentLine.Size = UDim2.new(1, 0, 0, 2)
accentLine.Position = UDim2.new(0, 0, 1, -2)
accentLine.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
accentLine.BorderSizePixel = 0
accentLine.Parent = titleBar

-- Content Area
local contentFrame = Instance.new("Frame")
contentFrame.Name = "ContentFrame"
contentFrame.Size = UDim2.new(1, -20, 1, -(titleBar.Size.Y.Offset + 10 + 10))
contentFrame.Position = UDim2.new(0, 10, 0, titleBar.Size.Y.Offset + 10)
contentFrame.BackgroundTransparency = 1
contentFrame.Parent = mainFrame

-- Nút No Fog
local fogFeatureButton = Instance.new("TextButton")
fogFeatureButton.Name = "FogFeatureButton"
fogFeatureButton.Size = UDim2.new(1, 0, 0, 40) -- Chiều cao nút
fogFeatureButton.Position = UDim2.new(0, 0, 0, 10) -- Nút đầu tiên, padding trên
fogFeatureButton.BackgroundColor3 = Color3.fromRGB(55, 58, 66) -- Màu nút mặc định
fogFeatureButton.TextColor3 = Color3.fromRGB(200, 205, 210)
fogFeatureButton.Text = "Enable No Fog"
fogFeatureButton.Font = Enum.Font.SourceSansSemibold
fogFeatureButton.TextSize = 16
fogFeatureButton.Parent = contentFrame

local fogButtonCorner = Instance.new("UICorner")
fogButtonCorner.CornerRadius = UDim.new(0, 6)
fogButtonCorner.Parent = fogFeatureButton

local fogButtonStroke = Instance.new("UIStroke")
fogButtonStroke.Color = Color3.fromRGB(40, 43, 50)
fogButtonStroke.Thickness = 1.5
fogButtonStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
fogButtonStroke.Parent = fogFeatureButton

-- Nút Full Bright
local fullbrightFeatureButton = Instance.new("TextButton")
fullbrightFeatureButton.Name = "FullbrightFeatureButton"
fullbrightFeatureButton.Size = UDim2.new(1, 0, 0, 40)
fullbrightFeatureButton.Position = UDim2.new(0, 0, 0, fogFeatureButton.Position.Y.Offset + fogFeatureButton.Size.Y.Offset + 10) -- Dưới nút Fog, padding
fullbrightFeatureButton.BackgroundColor3 = Color3.fromRGB(55, 58, 66)
fullbrightFeatureButton.TextColor3 = Color3.fromRGB(200, 205, 210)
fullbrightFeatureButton.Text = "Enable Full Bright"
fullbrightFeatureButton.Font = Enum.Font.SourceSansSemibold
fullbrightFeatureButton.TextSize = 16
fullbrightFeatureButton.Parent = contentFrame

local fullbrightButtonCorner = Instance.new("UICorner")
fullbrightButtonCorner.CornerRadius = UDim.new(0, 6)
fullbrightButtonCorner.Parent = fullbrightFeatureButton

local fullbrightButtonStroke = Instance.new("UIStroke")
fullbrightButtonStroke.Color = Color3.fromRGB(40, 43, 50)
fullbrightButtonStroke.Thickness = 1.5
fullbrightButtonStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
fullbrightButtonStroke.Parent = fullbrightFeatureButton


-- Nút bật/tắt UI
local toggleUiButton = Instance.new("TextButton")
toggleUiButton.Name = "ToggleUiButton"
toggleUiButton.Size = UDim2.new(0, 120, 0, 30)
toggleUiButton.Position = UDim2.new(0, 15, 0, 15)
toggleUiButton.BackgroundColor3 = Color3.fromRGB(45, 48, 56)
toggleUiButton.TextColor3 = Color3.fromRGB(220, 225, 230)
toggleUiButton.Text = "Toggle UI (F1)"
toggleUiButton.Font = Enum.Font.SourceSansBold
toggleUiButton.TextSize = 14
toggleUiButton.Parent = screenGui

local toggleUiCorner = Instance.new("UICorner")
toggleUiCorner.CornerRadius = UDim.new(0, 6)
toggleUiCorner.Parent = toggleUiButton

local toggleUiStroke = Instance.new("UIStroke")
toggleUiStroke.Color = Color3.fromRGB(25, 28, 36)
toggleUiStroke.Thickness = 1.5
toggleUiStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
toggleUiStroke.Parent = toggleUiButton

-- FUNCTIONS FOR FEATURES
local function updateFeatureButtonStates()
    if isFogRemoved then
        fogFeatureButton.Text = "Disable No Fog (Active)"
        fogFeatureButton.BackgroundColor3 = Color3.fromRGB(76, 175, 80) -- Green
        fogFeatureButton.TextColor3 = Color3.fromRGB(240, 240, 240)
    else
        fogFeatureButton.Text = "Enable No Fog"
        fogFeatureButton.BackgroundColor3 = Color3.fromRGB(55, 58, 66) -- Default
        fogFeatureButton.TextColor3 = Color3.fromRGB(200, 205, 210)
    end

    if isFullbrightActive then
        fullbrightFeatureButton.Text = "Disable Full Bright (Active)"
        fullbrightFeatureButton.BackgroundColor3 = Color3.fromRGB(76, 175, 80) -- Green
        fullbrightFeatureButton.TextColor3 = Color3.fromRGB(240, 240, 240)
    else
        fullbrightFeatureButton.Text = "Enable Full Bright"
        fullbrightFeatureButton.BackgroundColor3 = Color3.fromRGB(55, 58, 66) -- Default
        fullbrightFeatureButton.TextColor3 = Color3.fromRGB(200, 205, 210)
    end
end

local function applyFogSettings()
    Lighting.FogEnd = 1e10
    Lighting.FogStart = 1e10
    Lighting.FogColor = Color3.new(1, 1, 1)
end

local function restoreFogSettings()
    Lighting.FogEnd = originalFogEnd
    Lighting.FogStart = originalFogStart
    Lighting.FogColor = originalFogColor
end

local function applyFullbrightSettings()
    Lighting.Ambient = Color3.new(1, 1, 1)
    Lighting.ColorShift_Bottom = Color3.new(1, 1, 1)
    Lighting.ColorShift_Top = Color3.new(1, 1, 1)
end

local function restoreFullbrightSettings()
    Lighting.Ambient = originalAmbient
    Lighting.ColorShift_Bottom = originalColorShift_Bottom
    Lighting.ColorShift_Top = originalColorShift_Top
end

local function toggleFogFeature()
    isFogRemoved = not isFogRemoved
    if isFogRemoved then
        applyFogSettings()
        StarterGui:SetCore("SendNotification", {
            Title = "No Fog",
            Text = "Activated!",
            Duration = 2
        })
    else
        restoreFogSettings()
        StarterGui:SetCore("SendNotification", {
            Title = "No Fog",
            Text = "Deactivated.",
            Duration = 2
        })
    end
    updateFeatureButtonStates()
end

local function toggleFullbrightFeature()
    isFullbrightActive = not isFullbrightActive
    if isFullbrightActive then
        applyFullbrightSettings()
        StarterGui:SetCore("SendNotification", {
            Title = "Full Bright",
            Text = "Activated!",
            Duration = 2
        })
    else
        restoreFullbrightSettings()
        StarterGui:SetCore("SendNotification", {
            Title = "Full Bright",
            Text = "Deactivated.",
            Duration = 2
        })
    end
    updateFeatureButtonStates()
end

-- UI Interaction Logic
mainFrame.Visible = false -- Bắt đầu ẩn

toggleUiButton.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)

UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if gameProcessedEvent then return end
    if input.KeyCode == Enum.KeyCode.F1 then
        mainFrame.Visible = not mainFrame.Visible
    end
end)

-- Connect Feature Button Clicks
fogFeatureButton.MouseButton1Click:Connect(toggleFogFeature)
fullbrightFeatureButton.MouseButton1Click:Connect(toggleFullbrightFeature)

-- Persistent checks (from original script, but conditional)
Lighting:GetPropertyChangedSignal("FogEnd"):Connect(function()
    if isFogRemoved then applyFogSettings() end
end)
Lighting:GetPropertyChangedSignal("FogStart"):Connect(function()
    if isFogRemoved then applyFogSettings() end
end)
Lighting:GetPropertyChangedSignal("FogColor"):Connect(function()
    if isFogRemoved then applyFogSettings() end
end)
Lighting.Changed:Connect(function(property)
    if property == "FogEnd" or property == "FogStart" or property == "FogColor" then
        if isFogRemoved then applyFogSettings() end
    end
    -- For fullbright, LightingChanged is more general
end)

Lighting.LightingChanged:Connect(function() -- Catches Ambient, ColorShift changes
    if isFullbrightActive then applyFullbrightSettings() end
end)


-- Initial Notifications (as in your original script)
StarterGui:SetCore(
    "SendNotification",
    {
        Title = "No Fog", -- Sửa lại từ "Frog"
        Text = "Controller Ready",
        Duration = 2
})
StarterGui:SetCore(
    "SendNotification",
    {
        Title = "Full Bright",
        Text = "Controller Ready",
        Duration = 3
})

-- Add GUI to PlayerGui
screenGui.Parent = Players.LocalPlayer:WaitForChild("PlayerGui")

-- Initialize button states on load
updateFeatureButtonStates()

print("Modern Effects UI with Features Loaded.")
